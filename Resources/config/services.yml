parameters:
    # Entities
    oro_dotmailer.entity.transport.class:                          Oro\Bundle\DotmailerBundle\Entity\DotmailerTransport
    oro_dotmailer.entity.campaign.class:                           Oro\Bundle\DotmailerBundle\Entity\Campaign
    oro_dotmailer.entity.address_book.class:                       Oro\Bundle\DotmailerBundle\Entity\AddressBook
    oro_dotmailer.entity.address_book_contact.class:               Oro\Bundle\DotmailerBundle\Entity\AddressBookContact
    oro_dotmailer.entity.contact.class:                            Oro\Bundle\DotmailerBundle\Entity\Contact
    oro_dotmailer.entity.activity.class:                           Oro\Bundle\DotmailerBundle\Entity\Activity
    oro_dotmailer.entity.campaign_summary.class:                   Oro\Bundle\DotmailerBundle\Entity\CampaignSummary
    oro_dotmailer.entity.datafield.class:                          Oro\Bundle\DotmailerBundle\Entity\DataField
    oro_dotmailer.entity.datafield_mapping.class:                  Oro\Bundle\DotmailerBundle\Entity\DataFieldMapping
    oro_dotmailer.entity.datafield_mapping_config.class:           Oro\Bundle\DotmailerBundle\Entity\DataFieldMappingConfig

    # Integration related services
    oro_dotmailer.provider.channel_type.class:                           Oro\Bundle\DotmailerBundle\Provider\ChannelType
    oro_dotmailer.transport.integration_transport.class:                 Oro\Bundle\DotmailerBundle\Provider\Transport\DotmailerTransport
    oro_dotmailer.transport.resources_factory.class:                     Oro\Bundle\DotmailerBundle\Provider\Transport\DotmailerResourcesFactory
    oro_dotmailer.provider.marketing_list_items.query_builder.class:     Oro\Bundle\DotmailerBundle\Provider\MarketingListItemsQueryBuilderProvider
    oro_dotmailer.provider.cache.class:                                  Oro\Bundle\DotmailerBundle\Provider\CacheProvider
    oro_dotmailer.provider.campaign_statistic.class:                     Oro\Bundle\DotmailerBundle\Provider\CampaignStatisticProvider
    oro_dotmailer.contact.export.query_builder_adapter.class:            Oro\Bundle\DotmailerBundle\Provider\ContactExportQBAdapter
    oro_dotmailer.contact.export.query_builder_adapter.registry:         Oro\Bundle\DotmailerBundle\Provider\ContactExportQBAdapterRegistry
    oro_dotmailer.export_manager.class:                                  Oro\Bundle\DotmailerBundle\Model\ExportManager
    oro_dotmailer.datafield_manager.class:                               Oro\Bundle\DotmailerBundle\Model\DataFieldManager
    oro_dotmailer.log_helper.class:                                      Oro\Bundle\DotmailerBundle\Model\ImportExportLogHelper

    # Forms and Extensions
    oro_dotmailer.form.event_listener.integration_transport_settings.class: Oro\Bundle\DotmailerBundle\Form\EventListener\IntegrationSettingsSubscriber
    oro_dotmailer.form.type.integration_transport_settings.class:           Oro\Bundle\DotmailerBundle\Form\Type\IntegrationSettingsType
    oro_dotmailer.form.type.transport_settings.class:                       Oro\Bundle\DotmailerBundle\Form\Type\DotmailerTransportSettingsType
    oro_dotmailer.form.type.marketing_list_connection.class:                Oro\Bundle\DotmailerBundle\Form\Type\MarketingListConnectionType
    oro_dotmailer.form.type.integration_select.class:                       Oro\Bundle\DotmailerBundle\Form\Type\IntegrationSelectType
    oro_dotmailer.form.type.address_book_select.class:                      Oro\Bundle\DotmailerBundle\Form\Type\AddressBookSelectType
    oro_dotmailer.form.type.transport_check.class:                          Oro\Bundle\DotmailerBundle\Form\Type\DotmailerTransportCheckButtonType
    oro_dotmailer.form.extension.channel_connectors.class:                  Oro\Bundle\DotmailerBundle\Form\Extension\ChannelConnectorsExtension
    oro_dotmailer.form.type.datafield.class:                                Oro\Bundle\DotmailerBundle\Form\Type\DataFieldType
    oro_dotmailer.form.type.datafield_select.class:                         Oro\Bundle\DotmailerBundle\Form\Type\DataFieldSelectType
    oro_dotmailer.form.type.datafield_mapping.class:                        Oro\Bundle\DotmailerBundle\Form\Type\DataFieldMappingType
    oro_dotmailer.form.type.datafield_mapping_config.class:                 Oro\Bundle\DotmailerBundle\Form\Type\DataFieldMappingConfigType
    oro_dotmailer.form.event_listener.datafield.class:                      Oro\Bundle\DotmailerBundle\Form\EventListener\DataFieldFormSubscriber
    oro_dotmailer.form.event_listener.datafield_mapping.class:              Oro\Bundle\DotmailerBundle\Form\EventListener\DataFieldMappingFormSubscriber

    #Form handlers
    oro_dotmailer.form.handler.connection_update.class:            Oro\Bundle\DotmailerBundle\Form\Handler\ConnectionUpdateFormHandler
    oro_dotmailer.form.handler.datafield_update.class:             Oro\Bundle\DotmailerBundle\Form\Handler\DataFieldFormHandler

    #data converters
    oro_dotmailer.importexport.data_converter.not_exported_contact.class:              Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\NotExportedContactDataConverter
    oro_dotmailer.importexport.data_converter.address_book.class:                      Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\AddressBookDataConverter
    oro_dotmailer.importexport.data_converter.unsubscribed_contact.class:              Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\UnsubscribedContactDataConverter
    oro_dotmailer.importexport.data_converter.unsubscribed_from_account_contact.class: Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\UnsubscribedFromAccountContactDataConverter
    oro_dotmailer.importexport.data_converter.campaign.class:                          Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\CampaignDataConverter
    oro_dotmailer.importexport.data_converter.contact.class:                           Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\ContactDataConverter
    oro_dotmailer.importexport.data_converter.activity_contact.class:                  Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\ActivityContactDataConverter
    oro_dotmailer.importexport.data_converter.campaign_summary.class:                  Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\CampaignSummaryDataConverter
    oro_dotmailer.importexport.data_converter.contact_sync.class:                      Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\ContactSyncDataConverter
    oro_dotmailer.importexport.data_converter.datafield.class:                         Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\DataFieldDataConverter
    oro_dotmailer.importexport.data_converter.update_entity_field_from_contacts.class: Oro\Bundle\DotmailerBundle\ImportExport\DataConverter\UpdateEntityFieldsFromContactDataConverter

    #reader
    oro_dotmailer.importexport.reader.abstract.class:                            Oro\Bundle\DotmailerBundle\ImportExport\Reader\AbstractReader
    oro_dotmailer.importexport.reader.export.abstract.class:                     Oro\Bundle\DotmailerBundle\ImportExport\Reader\AbstractExportReader
    oro_dotmailer.importexport.reader.not_exported_contact.class:                Oro\Bundle\DotmailerBundle\ImportExport\Reader\NotExportedContactReader
    oro_dotmailer.importexport.reader.unsubscribed_contact_sync.class:           Oro\Bundle\DotmailerBundle\ImportExport\Reader\UnsubscribedContactSyncReader
    oro_dotmailer.importexport.reader.unsubscribed_from_account_contact.class:   Oro\Bundle\DotmailerBundle\ImportExport\Reader\UnsubscribedFromAccountContactReader
    oro_dotmailer.importexport.reader.removed_contact_export.class:              Oro\Bundle\DotmailerBundle\ImportExport\Reader\RemovedContactExportReader
    oro_dotmailer.importexport.reader.scheduled_for_export.class:                Oro\Bundle\DotmailerBundle\ImportExport\Reader\ScheduledForExportContactReader
    oro_dotmailer.importexport.reader.address_book.remove.class:                 Oro\Bundle\DotmailerBundle\ImportExport\Reader\RemoveAddressBookReader
    oro_dotmailer.importexport.reader.campaign.remove.class:                     Oro\Bundle\DotmailerBundle\ImportExport\Reader\RemoveCampaignReader
    oro_dotmailer.importexport.reader.export.rejected_contact.class:             Oro\Bundle\DotmailerBundle\ImportExport\Reader\RejectedContactExportReader
    oro_dotmailer.importexport.reader.datafield.remove.class:                    Oro\Bundle\DotmailerBundle\ImportExport\Reader\RemoveDataFieldReader
    oro_dotmailer.importexport.reader.update_entity_field_from_contacts.class:   Oro\Bundle\DotmailerBundle\ImportExport\Reader\UpdateEntityFieldsFromContactReader

    #connectors
    oro_dotmailer.connector.abstract.class:                            Oro\Bundle\DotmailerBundle\Provider\Connector\AbstractDotmailerConnector
    oro_dotmailer.connector.address_book.class:                        Oro\Bundle\DotmailerBundle\Provider\Connector\AddressBookConnector
    oro_dotmailer.connector.campaign.class:                            Oro\Bundle\DotmailerBundle\Provider\Connector\CampaignConnector
    oro_dotmailer.connector.contact.class:                             Oro\Bundle\DotmailerBundle\Provider\Connector\ContactConnector
    oro_dotmailer.connector.unsubscribed_contact.class:                Oro\Bundle\DotmailerBundle\Provider\Connector\UnsubscribedContactConnector
    oro_dotmailer.connector.activity_contact.class:                    Oro\Bundle\DotmailerBundle\Provider\Connector\ActivityContactConnector
    oro_dotmailer.connector.campaign_summary.class:                    Oro\Bundle\DotmailerBundle\Provider\Connector\CampaignSummaryConnector
    oro_dotmailer.connector.export_contacts.class:                     Oro\Bundle\DotmailerBundle\Provider\Connector\ExportContactConnector
    oro_dotmailer.connector.datafield.class:                           Oro\Bundle\DotmailerBundle\Provider\Connector\DataFieldConnector

    #strategy
    oro_dotmailer.importexport.strategy.add_or_replace.class:                      Oro\Bundle\DotmailerBundle\ImportExport\Strategy\AddOrReplaceStrategy
    oro_dotmailer.importexport.strategy.import.abstract.class:                     Oro\Bundle\DotmailerBundle\ImportExport\Strategy\AbstractImportStrategy
    oro_dotmailer.importexport.strategy.not_exported_contact.class:                Oro\Bundle\DotmailerBundle\ImportExport\Strategy\NotExportedContactStrategy
    oro_dotmailer.importexport.strategy.address_book.class:                        Oro\Bundle\DotmailerBundle\ImportExport\Strategy\AddressBookStrategy
    oro_dotmailer.importexport.strategy.remove_address_book.class:                 Oro\Bundle\DotmailerBundle\ImportExport\Strategy\RemoveAddressBookStrategy
    oro_dotmailer.importexport.strategy.remove_campaign.class:                     Oro\Bundle\DotmailerBundle\ImportExport\Strategy\RemoveCampaignStrategy
    oro_dotmailer.importexport.strategy.unsubscribed_contact.class:                Oro\Bundle\DotmailerBundle\ImportExport\Strategy\UnsubscribedContactStrategy
    oro_dotmailer.importexport.strategy.unsubscribed_from_account_contact.class:   Oro\Bundle\DotmailerBundle\ImportExport\Strategy\UnsubscribedFromAccountContactStrategy
    oro_dotmailer.importexport.strategy.campaign.class:                            Oro\Bundle\DotmailerBundle\ImportExport\Strategy\CampaignStrategy
    oro_dotmailer.importexport.strategy.activity_contact.class:                    Oro\Bundle\DotmailerBundle\ImportExport\Strategy\ActivityContactStrategy
    oro_dotmailer.importexport.strategy.contact.class:                             Oro\Bundle\DotmailerBundle\ImportExport\Strategy\ContactStrategy
    oro_dotmailer.importexport.strategy.contact_sync.class:                        Oro\Bundle\DotmailerBundle\ImportExport\Strategy\ContactSyncStrategy
    oro_dotmailer.importexport.strategy.datafield.class:                           Oro\Bundle\DotmailerBundle\ImportExport\Strategy\DataFieldStrategy
    oro_dotmailer.importexport.strategy.remove_datafield.class:                    Oro\Bundle\DotmailerBundle\ImportExport\Strategy\RemoveDataFieldStrategy
    oro_dotmailer.importexport.strategy.update_entity_field_from_contacts.class:   Oro\Bundle\DotmailerBundle\ImportExport\Strategy\UpdateEntityFieldsFromContactStrategy

    #processor
    oro_dotmailer.importexport.processor.import_abstract.class:            Oro\Bundle\DotmailerBundle\ImportExport\Processor\ImportProcessor
    oro_dotmailer.importexport.processor.unsubscribed_contact_sync.class:  Oro\Bundle\DotmailerBundle\ImportExport\Processor\UnsubscribedContactSyncProcessor
    oro_dotmailer.importexport.processor.contact_sync.class:               Oro\Bundle\DotmailerBundle\ImportExport\Processor\ContactSyncProcessor
    oro_dotmailer.importexport.processor.export_removed.class:             Oro\Bundle\DotmailerBundle\ImportExport\Processor\RemovedExportProcessor
    oro_dotmailer.importexport.processor.export_contact.class:             Oro\Bundle\DotmailerBundle\ImportExport\Processor\ExportContactProcessor
    oro_dotmailer.importexport.processor.export.rejected_contact.class:    Oro\Bundle\DotmailerBundle\ImportExport\Processor\RejectedContactExportProcessor
    oro_dotmailer.importexport.processor.import.update_entity_field_from_contacts.class: Oro\Bundle\DotmailerBundle\ImportExport\Processor\UpdateEntityFieldsFromContactProcessor

    #writers
    oro_dotmailer.importexport.writer.import.class:                      Oro\Bundle\DotmailerBundle\ImportExport\Writer\ImportWriter
    oro_dotmailer.importexport.writer.contact_sync.class:                Oro\Bundle\DotmailerBundle\ImportExport\Writer\ContactSyncWriter
    oro_dotmailer.importexport.writer.unsubscribed_contact_sync.class:   Oro\Bundle\DotmailerBundle\ImportExport\Writer\UnsubscribedContactSyncWriter
    oro_dotmailer.importexport.writer.import.remove.class:               Oro\Bundle\DotmailerBundle\ImportExport\Writer\RemoveWriter
    oro_dotmailer.importexport.writer.import.removed_contact.class:      Oro\Bundle\DotmailerBundle\ImportExport\Writer\RemoveCampaignWriter
    oro_dotmailer.importexport.writer.export.contacts.class:             Oro\Bundle\DotmailerBundle\ImportExport\Writer\ContactsExportWriter
    oro_dotmailer.importexport.writer.export.removed_contacts.class:     Oro\Bundle\DotmailerBundle\ImportExport\Writer\RemovedContactsExportWriter
    oro_dotmailer.importexport.writer.export.rejected_contact.class:    Oro\Bundle\DotmailerBundle\ImportExport\Writer\RejectedContactExportWriter

    #serializer
    oro_dotmailer.importexport.normalizer.enum.class:              Oro\Bundle\DotmailerBundle\ImportExport\Serializer\EnumNormalizer
    oro.dotmailer.importexport.normalizer.configurable.class:      Oro\Bundle\DotmailerBundle\ImportExport\Serializer\ConfigurableEntityNormalizer
    oro_dotmailer.importexport.normalizer.datetime.class:          Oro\Bundle\DotmailerBundle\ImportExport\Serializer\DateTimeNormalizer

    #filters
    oro_dotmailer.placeholder.filter.buttons_filter.class:         Oro\Bundle\DotmailerBundle\Placeholders\ButtonFilter
    oro_dotmailer.placeholder.filter.email_campaign.class:         Oro\Bundle\DotmailerBundle\Placeholders\EmailCampaignPlaceholderFilter
    oro_dotmailer.placeholder.filter.marketing_list.class:         Oro\Bundle\DotmailerBundle\Placeholders\MarketingListPlaceholderFilter

    #search handlers
    oro_dotmailer.form.autocomplete.list.search_handler.class:               Oro\Bundle\DotmailerBundle\Autocomplete\AddressBooksSearchHandler
    oro_dotmailer.form.autocomplete.channel_aware.search_handler.class:      Oro\Bundle\DotmailerBundle\Autocomplete\ChannelAwareSearchHandler

    #workflow actions
    oro_dotmailer.workflow.action.update_email_campaign_statistics.class: Oro\Bundle\DotmailerBundle\Model\Action\UpdateEmailCampaignStatistics
    oro_dotmailer.workflow.action.abstract_marketing_list_entities.class: Oro\Bundle\DotmailerBundle\Model\Action\AbstractMarketingListEntitiesAction
    oro_dotmailer.workflow.action.create_marketing_list_state_item.class: Oro\Bundle\DotmailerBundle\Model\Action\MarketingListStateItemCreateAction
    oro_dotmailer.workflow.action.remove_marketing_list_state_item.class: Oro\Bundle\DotmailerBundle\Model\Action\MarketingListStateItemRemoveAction

    #helpers
    oro_dotmailer.model.field_helper.class: Oro\Bundle\DotmailerBundle\Model\FieldHelper

    #voters
    oro_dotmailer.email_campaign.security.acl.voter.entity.class:  Oro\Bundle\DotmailerBundle\Acl\Voter\EmailCampaignVoter
    oro_dotmailer.acl.voter.marketing_list_state_item.class:       Oro\Bundle\DotmailerBundle\Acl\Voter\MarketingListStateItemVoter

    #listeners
    oro_dotmailer.listener.datagrid.marketing_list_item.class:     Oro\Bundle\DotmailerBundle\EventListener\Datagrid\MarketingListItemGridListener
    oro_dotmailer.listener.cache_clear.class:                      Oro\Bundle\DotmailerBundle\EventListener\CacheClearListener
    oro_dotmailer.listener.contact_export.class:                   Oro\Bundle\DotmailerBundle\EventListener\ContactExportListener
    oro_dotmailer.listener.update_address_book_last_imported_date.class: Oro\Bundle\DotmailerBundle\EventListener\UpdateAddressBookLastImportDateListener
    oro_dotmailer.listener.datafield_remove.class:                       Oro\Bundle\DotmailerBundle\EventListener\DataFieldRemoveListener
    oro_dotmailer.listener.add_default_mapping.class:                    Oro\Bundle\DotmailerBundle\EventListener\AddDefaultMappingListener
    oro_dotmailer.listener.navigation.class:                             Oro\Bundle\DotmailerBundle\EventListener\NavigationListener

    #validators
    oro_dotmailer.validator.datafield_mapping_config.class:        Oro\Bundle\DotmailerBundle\Validator\DataFieldMappingConfigValidator

    oro_dotmailer.transport.dotmailer.class: Oro\Bundle\DotmailerBundle\Transport\DotmailerEmailCampaignTransport
services:
    oro_dotmailer.entity_provider:
        alias: oro_entity.entity_provider
    # Forms and Extensions
    oro_dotmailer.form.event_listener.integration_transport_settings:
        class: %oro_dotmailer.form.event_listener.integration_transport_settings.class%
        arguments:
            - "@oro_security.encoder.mcrypt"

    oro_dotmailer.form.type.integration_transport_settings:
        class: %oro_dotmailer.form.type.integration_transport_settings.class%
        arguments:
            - "@oro_dotmailer.form.event_listener.integration_transport_settings"
        tags:
            - { name: form.type, alias: "oro_dotmailer_transport_setting_type" }

    oro_dotmailer.form.type.marketing_list_connection:
        class: %oro_dotmailer.form.type.marketing_list_connection.class%
        tags:
            - { name: form.type, alias: "oro_dotmailer_marketing_list_connection" }

    oro_dotmailer.form.type.integration_select:
        class: %oro_dotmailer.form.type.integration_select.class%
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"
        tags:
            - { name: form.type, alias: "oro_dotmailer_integration_select" }

    oro_dotmailer.form.type.transport_settings:
        class: %oro_dotmailer.form.type.transport_settings.class%
        tags:
            - { name: form.type, alias: "oro_dotmailer_email_transport_settings" }

    oro_dotmailer.form.type.address_book_select:
        class: %oro_dotmailer.form.type.address_book_select.class%
        tags:
            - { name: form.type, alias: "oro_dotmailer_address_book_list_select" }

    oro_dotmailer.form.type.datafield_select:
        class: %oro_dotmailer.form.type.datafield_select.class%
        tags:
            - { name: form.type, alias: "oro_dotmailer_datafield_select" }

    oro_dotmailer.form.autocomplete.channel_aware.search_handler:
        class: %oro_dotmailer.form.autocomplete.channel_aware.search_handler.class%
        abstract:  true
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]

    oro_dotmailer.form.autocomplete.list.search_handler:
        class: %oro_dotmailer.form.autocomplete.list.search_handler.class%
        parent: oro_dotmailer.form.autocomplete.channel_aware.search_handler
        arguments:
            - %oro_dotmailer.entity.address_book.class%
            - ["name"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "dotmailer_address_books" }

    oro_dotmailer.form.autocomplete.datafield_list.search_handler:
        parent: oro_dotmailer.form.autocomplete.channel_aware.search_handler
        arguments:
            - %oro_dotmailer.entity.datafield.class%
            - ["name"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "dotmailer_data_fields" }

    oro_dotmailer.form.extension.channel_connectors:
        class: %oro_dotmailer.form.extension.channel_connectors.class%
        tags:
            - { name: form.type_extension, alias: oro_integration_channel_form }

    oro_dotmailer.form.type.soap_transport_check:
        class: %oro_dotmailer.form.type.transport_check.class%
        tags:
            - { name: form.type, alias: oro_dotmailer_transport_check_button }

    oro_dotmailer.form.event_listener.datafield:
        class: %oro_dotmailer.form.event_listener.datafield.class%

    oro_dotmailer.form.event_listener.datafield_mapping:
        class: %oro_dotmailer.form.event_listener.datafield_mapping.class%

    oro_dotmailer.form.type.datafield:
        class: %oro_dotmailer.form.type.datafield.class%
        arguments:
            - "%oro_dotmailer.entity.datafield.class%"
            - "@oro_dotmailer.form.event_listener.datafield"
        tags:
            - { name: form.type, alias: "oro_dotmailer_data_field" }

    oro_dotmailer.form.type.datafield_mapping:
        class: %oro_dotmailer.form.type.datafield_mapping.class%
        arguments:
            - "%oro_dotmailer.entity.datafield_mapping.class%"
            - "@oro_dotmailer.form.event_listener.datafield_mapping"
        tags:
            - { name: form.type, alias: "oro_dotmailer_datafield_mapping" }

    oro_dotmailer.form.type.datafield_mapping_config:
        class: %oro_dotmailer.form.type.datafield_mapping_config.class%
        arguments:
            - "%oro_dotmailer.entity.datafield_mapping_config.class%"
        tags:
            - { name: form.type, alias: "oro_dotmailer_datafield_mapping_config" }

    oro_dotmailer.datafield.manager.api:
        class: 'Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager'
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - "%oro_dotmailer.entity.datafield.class%"
            - "@doctrine.orm.entity_manager"

    oro_dotmailer.datafield_mapping.manager.api:
        class: 'Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager'
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - "%oro_dotmailer.entity.datafield_mapping.class%"
            - "@doctrine.orm.entity_manager"

    oro_dotmailer.datafield.form:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - "oro_dotmailer_data_field_form"
            - "oro_dotmailer_data_field"

    oro_dotmailer.datafield_mapping.form:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - "oro_dotmailer_datafield_mapping_form"
            - "oro_dotmailer_datafield_mapping"

    #Form handlers
    oro_dotmailer.form.handler.connection_update:
        class: %oro_dotmailer.form.handler.connection_update.class%
        arguments:
            - "@doctrine"
            - "@request"
        scope: request

    oro_dotmailer.form.handler.datafield_update:
        class: %oro_dotmailer.form.handler.datafield_update.class%
        arguments:
            - "@oro_dotmailer.datafield.form"
            - "@doctrine"
            - "@request"
            - "@logger"
            - "@translator"
            - "@oro_dotmailer.datafield_manager"
        scope: request

    # Integration related services
    oro_dotmailer.provider.channel_type:
        class: %oro_dotmailer.provider.channel_type.class%
        tags:
            - { name: oro_integration.channel, type: dotmailer }

    oro_dotmailer.transport.integration_transport:
        class: %oro_dotmailer.transport.integration_transport.class%
        arguments:
            - "@oro_dotmailer.transport.resources_factory"
            - "@oro_security.encoder.mcrypt"
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
        tags:
            - { name: oro_integration.transport, type: dotmailer_api, channel_type: dotmailer }

    oro_dotmailer.transport.resources_factory:
        class: %oro_dotmailer.transport.resources_factory.class%

    oro_dotmailer.export_manager:
        class: %oro_dotmailer.export_manager.class%
        arguments:
            - "@doctrine"
            - "@oro_dotmailer.transport.integration_transport"
            - "@oro_integration.job_executor"
            - %oro_dotmailer.entity.address_book_contact.class%

    oro_dotmailer.datafield_manager:
        class: %oro_dotmailer.datafield_manager.class%
        arguments:
            - "@oro_dotmailer.transport.integration_transport"

    oro_dotmailer.provider.marketing_list_items.query_builder:
        class: %oro_dotmailer.provider.marketing_list_items.query_builder.class%
        arguments:
            - "@oro_marketing_list.provider.marketing_list"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_security.owner.ownership_metadata_provider"
            - "@doctrine"
            - "@oro_dotmailer.model.field_helper"
            - "@oro_dotmailer.contact.export.query_builder_adapter.registry"
        calls:
            - [setRemovedItemClassName, [%oro_marketing_list.removed_item.class%]]
            - [setUnsubscribedItemClassName, [%oro_marketing_list.unsubscribed_item.class%]]
            - [setContactClassName, [%oro_dotmailer.entity.contact.class%]]
            - [setAddressBookContactClassName, [%oro_dotmailer.entity.address_book_contact.class%]]

    oro_dotmailer.provider.cache:
        class: %oro_dotmailer.provider.cache.class%

    oro_dotmailer.provider.campaign_statistic:
        class: %oro_dotmailer.provider.campaign_statistic.class%
        arguments:
            - "@oro_campaign.email_campaign.statistics_connector"
            - "@doctrine"
            - "@oro_entity.doctrine_helper"
            - "@oro_dotmailer.provider.cache"

    oro_dotmailer.contact.export.query_builder_adapter:
        class: %oro_dotmailer.contact.export.query_builder_adapter.class%
        arguments:
            - "@oro_dotmailer.provider.mapping"
            - "@oro_dotmailer.query_designer.mapping_query_converter"
        tags:
            - { name: oro_dotmailer.contact.export.query_builder_adapter, priority: -10 }

    oro_dotmailer.contact.export.query_builder_adapter.registry:
        class: %oro_dotmailer.contact.export.query_builder_adapter.registry%

    oro_dotmailer.log_helper:
        class: %oro_dotmailer.log_helper.class%

    oro_dotmailer.cache:
        public: false
        parent: oro.cache.abstract
        calls:
            - [setNamespace, [ 'oro_dotmailer' ] ]

    oro_dotmailer.provider.mapping:
        class: 'Oro\Bundle\DotmailerBundle\Provider\MappingProvider'
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_dotmailer.cache"

    oro_dotmailer.query_designer.mapping_query_converter:
        class: 'Oro\Bundle\DotmailerBundle\QueryDesigner\MappingQueryConverter'
        arguments:
            - "@oro_query_designer.query_designer.manager"
            - "@oro_entity.virtual_field_provider.chain"
            - "@doctrine"
        calls:
            - [setVirtualRelationProvider, ["@oro_entity.virtual_relation_provider.chain"]]

    oro_dotmailer.query_designer.parent_entity_query_converter:
        class: 'Oro\Bundle\DotmailerBundle\QueryDesigner\ParentEntityFindQueryConverter'
        arguments:
            - "@oro_query_designer.query_designer.manager"
            - "@oro_entity.virtual_field_provider.chain"
            - "@doctrine"
        calls:
            - [setVirtualRelationProvider, ["@oro_entity.virtual_relation_provider.chain"]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]

    #readers
    oro_dotmailer.importexport.reader.abstract:
        class: %oro_dotmailer.importexport.reader.abstract.class%
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.provider.connector_context_mediator"
            - "@doctrine"
            - "@oro_integration.logger.strategy"

    oro_dotmailer.importexport.reader.export.abstract:
        class: %oro_dotmailer.importexport.reader.export.abstract.class%
        parent: oro_dotmailer.importexport.reader.abstract
        abstract: true
        calls:
            - [setMarketingListItemsQueryBuilderProvider,  ["@oro_dotmailer.provider.marketing_list_items.query_builder"]]

    oro_dotmailer.importexport.reader.not_exported_contact:
        class: %oro_dotmailer.importexport.reader.not_exported_contact.class%
        parent: oro_dotmailer.importexport.reader.abstract

    oro_dotmailer.importexport.reader.unsubscribed_contact_sync:
        class: %oro_dotmailer.importexport.reader.unsubscribed_contact_sync.class%
        parent: oro_dotmailer.importexport.reader.export.abstract

    oro_dotmailer.importexport.reader.unsubscribed_from_account_contact:
        class: %oro_dotmailer.importexport.reader.unsubscribed_from_account_contact.class%
        parent: oro_dotmailer.importexport.reader.abstract

    oro_dotmailer.importexport.reader.address_book.remove:
        parent: oro_dotmailer.importexport.reader.abstract
        class: %oro_dotmailer.importexport.reader.address_book.remove.class%

    oro_dotmailer.importexport.reader.campaign.remove:
        parent: oro_dotmailer.importexport.reader.abstract
        class: %oro_dotmailer.importexport.reader.campaign.remove.class%

    oro_dotmailer.importexport.reader.export.rejected_contact:
        parent: oro_dotmailer.importexport.reader.abstract
        class: %oro_dotmailer.importexport.reader.export.rejected_contact.class%

    oro_dotmailer.importexport.reader.removed_contact_export:
        class: %oro_dotmailer.importexport.reader.removed_contact_export.class%
        parent: oro_dotmailer.importexport.reader.export.abstract

    oro_dotmailer.importexport.reader.scheduled_for_export:
        class: %oro_dotmailer.importexport.reader.scheduled_for_export.class%
        parent: oro_dotmailer.importexport.reader.export.abstract

    oro_dotmailer.importexport.reader.datafield.remove:
        parent: oro_dotmailer.importexport.reader.abstract
        class: %oro_dotmailer.importexport.reader.datafield.remove.class%

    oro_dotmailer.importexport.reader.update_entity_field_from_contacts:
        parent: oro_dotmailer.importexport.reader.abstract
        class: %oro_dotmailer.importexport.reader.update_entity_field_from_contacts.class%

    #connectors
    oro_dotmailer.connector.abstract:
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setManagerRegistry,  ["@doctrine"]]

    oro_dotmailer.connector.address_book:
        class: %oro_dotmailer.connector.address_book.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.address_book.class%]]
        tags:
            - { name: oro_integration.connector, type: address_book, channel_type: dotmailer }


    oro_dotmailer.connector.campaign:
        class: %oro_dotmailer.connector.campaign.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.campaign.class%]]
        tags:
            - { name: oro_integration.connector, type: campaign, channel_type: dotmailer }

    oro_dotmailer.connector.contact:
        class: %oro_dotmailer.connector.contact.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]
        tags:
            - { name: oro_integration.connector, type: contact, channel_type: dotmailer }


    oro_dotmailer.connector.unsubscribed_contact:
        class: %oro_dotmailer.connector.unsubscribed_contact.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]
        tags:
            - { name: oro_integration.connector, type: unsubscribed_contact, channel_type: dotmailer }

    oro_dotmailer.connector.activity_contact:
        class: %oro_dotmailer.connector.activity_contact.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.activity.class%]]
        tags:
            - { name: oro_integration.connector, type: activity_contact, channel_type: dotmailer }

    oro_dotmailer.connector.campaign_summary:
        class: %oro_dotmailer.connector.campaign_summary.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.campaign_summary.class%]]
        tags:
            - { name: oro_integration.connector, type: campaign_summary, channel_type: dotmailer }

    oro_dotmailer.connector.export_contacts:
        class: %oro_dotmailer.connector.export_contacts.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]
            - [setMarketingListItemsQueryBuilderProvider,  ["@oro_dotmailer.provider.marketing_list_items.query_builder"]]
            - [setExportManager,  ["@oro_dotmailer.export_manager"]]
        tags:
            - { name: oro_integration.connector, type: contact_export, channel_type: dotmailer }

    oro_dotmailer.connector.datafield:
        class: %oro_dotmailer.connector.datafield.class%
        parent: oro_dotmailer.connector.abstract
        calls:
            - [setEntityName, [%oro_dotmailer.entity.datafield.class%]]
            - [setConfigManager, ["@oro_config.user"]]
        tags:
            - { name: oro_integration.connector, type: datafield, channel_type: dotmailer }

    #data converter
    oro_dotmailer.importexport.data_converter.not_exported_contact:
        class: %oro_dotmailer.importexport.data_converter.not_exported_contact.class%

    oro_dotmailer.importexport.data_converter.campaign:
        class: %oro_dotmailer.importexport.data_converter.campaign.class%

    oro_dotmailer.importexport.data_converter.address_book:
        class: %oro_dotmailer.importexport.data_converter.address_book.class%

    oro_dotmailer.importexport.data_converter.unsubscribed_contact:
        class: %oro_dotmailer.importexport.data_converter.unsubscribed_contact.class%

    oro_dotmailer.importexport.data_converter.unsubscribed_from_account_contact:
        class: %oro_dotmailer.importexport.data_converter.unsubscribed_from_account_contact.class%

    oro_dotmailer.importexport.data_converter.contact:
        class: %oro_dotmailer.importexport.data_converter.contact.class%
        calls:
            - [setMappingProvider, ["@oro_dotmailer.provider.mapping"]]

    oro_dotmailer.importexport.data_converter.activity_contact:
        class: %oro_dotmailer.importexport.data_converter.activity_contact.class%

    oro_dotmailer.importexport.data_converter.campaign_summary:
        class: %oro_dotmailer.importexport.data_converter.campaign_summary.class%

    oro_dotmailer.importexport.data_converter.contact_sync:
        class: %oro_dotmailer.importexport.data_converter.contact_sync.class%
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setCacheProvider, ["@oro_dotmailer.provider.cache"]]

    oro_dotmailer.importexport.data_converter.datafield:
        class: %oro_dotmailer.importexport.data_converter.datafield.class%

    oro_dotmailer.importexport.data_converter.update_entity_field_from_contacts:
        class: %oro_dotmailer.importexport.data_converter.update_entity_field_from_contacts.class%
        calls:
            - [setMappingProvider, ["@oro_dotmailer.provider.mapping"]]

    #strategy
    oro_dotmailer.importexport.strategy.add_or_replace:
        class: %oro_dotmailer.importexport.strategy.add_or_replace.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setOwnerHelper, ["@oro_integration.helper.default_owner_helper"]]
            - [setCacheProvider, ["@oro_dotmailer.provider.cache"]]
            - [setLogger, ["@oro_integration.logger.strategy"]]

    oro_dotmailer.importexport.strategy.import.abstract:
        class: %oro_dotmailer.importexport.strategy.import.abstract.class%
        abstract: true
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setCacheProvider, ["@oro_dotmailer.provider.cache"]]
            - [setLogger, ["@oro_integration.logger.strategy"]]

    oro_dotmailer.importexport.strategy.not_exported_contact:
        class: %oro_dotmailer.importexport.strategy.not_exported_contact.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.address_book:
        class: %oro_dotmailer.importexport.strategy.address_book.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace

    oro_dotmailer.importexport.strategy.remove_address_book:
        class: %oro_dotmailer.importexport.strategy.remove_address_book.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.remove_campaign:
        class: %oro_dotmailer.importexport.strategy.remove_campaign.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.unsubscribed_contact:
        class: %oro_dotmailer.importexport.strategy.unsubscribed_contact.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.campaign:
        class: %oro_dotmailer.importexport.strategy.campaign.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace

    oro_dotmailer.importexport.strategy.unsubscribed_from_account_contact:
        class: %oro_dotmailer.importexport.strategy.unsubscribed_from_account_contact.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.activity_contact:
        class: %oro_dotmailer.importexport.strategy.activity_contact.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace

    oro_dotmailer.importexport.strategy.contact:
        class: %oro_dotmailer.importexport.strategy.contact.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace
        calls:
            - [setMappingProvider, ["@oro_dotmailer.provider.mapping"]]

    oro_dotmailer.importexport.strategy.contact_sync:
        class: %oro_dotmailer.importexport.strategy.contact_sync.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace
        calls:
            - [setMappingProvider, ["@oro_dotmailer.provider.mapping"]]

    oro_dotmailer.importexport.strategy.datafield:
        class: %oro_dotmailer.importexport.strategy.datafield.class%
        parent: oro_dotmailer.importexport.strategy.add_or_replace

    oro_dotmailer.importexport.strategy.remove_datafield:
        class: %oro_dotmailer.importexport.strategy.remove_datafield.class%
        parent: oro_dotmailer.importexport.strategy.import.abstract

    oro_dotmailer.importexport.strategy.update_entity_field_from_contacts.add_or_replace:
        class: %oro_dotmailer.importexport.strategy.update_entity_field_from_contacts.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setStategyHelper, ["@oro_dotmailer.importexport.strategy.helper"]]

    oro_dotmailer.importexport.strategy.helper:
        class: 'Oro\Bundle\DotmailerBundle\ImportExport\Strategy\ImportStrategyHelperWithLog'
        parent: oro_importexport.strategy.import.helper
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]

    #processor
    oro_dotmailer.importexport.processor.import_abstract:
        class: %oro_dotmailer.importexport.processor.import_abstract.class%
        parent: oro_importexport.processor.import_abstract
        arguments:
            - "@oro_importexport.context_registry"
        abstract: true

    oro_dotmailer.importexport.processor.not_exported_contact:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.not_exported_contact"]]
            - [setEntityName, [%oro_dotmailer.entity.address_book_contact.class%]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.not_exported_contact"]]

    oro_dotmailer.importexport.processor.unsubscribed_contact_sync:
        class: %oro_dotmailer.importexport.processor.unsubscribed_contact_sync.class%
        arguments:
            - "@doctrine"
            - "@oro_importexport.context_registry"

    oro_dotmailer.importexport.processor.contact_sync:
        class: %oro_dotmailer.importexport.processor.contact_sync.class%
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.contact_sync"]]
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.contact_sync"]]

    oro_dotmailer.importexport.processor.address_book:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.address_book"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.address_book"]]
            - [setEntityName, [%oro_dotmailer.entity.address_book.class%]]

    oro_dotmailer.importexport.processor.address_book.remove:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.remove_address_book"]]
            - [setEntityName, [%oro_dotmailer.entity.address_book.class%]]

    oro_dotmailer.importexport.processor.datafield.remove:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.remove_datafield"]]
            - [setEntityName, [%oro_dotmailer.entity.datafield.class%]]

    oro_dotmailer.importexport.processor.remove_campaign:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.remove_campaign"]]
            - [setEntityName, [%oro_dotmailer.entity.campaign.class%]]

    oro_dotmailer.importexport.processor.unsubscribed_contact:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.unsubscribed_contact"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.unsubscribed_contact"]]
            - [setEntityName, [%oro_dotmailer.entity.address_book_contact.class%]]

    oro_dotmailer.importexport.processor.unsubscribed_from_account_contact:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.unsubscribed_from_account_contact"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.unsubscribed_from_account_contact"]]
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]

    oro_dotmailer.importexport.processor.campaign:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.campaign"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.campaign"]]
            - [setEntityName, [%oro_dotmailer.entity.campaign.class%]]
    
    oro_dotmailer.importexport.processor.contact:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.contact"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.contact"]]
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]

    oro_dotmailer.importexport.processor.activity_contact:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.activity_contact"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.activity_contact"]]
            - [setEntityName, [%oro_dotmailer.entity.activity.class%]]

    oro_dotmailer.importexport.processor.campaign_summary:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.campaign_summary"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.add_or_replace"]]
            - [setEntityName, [%oro_dotmailer.entity.campaign_summary.class%]]

    oro_dotmailer.importexport.processor.export_removed:
        class: %oro_dotmailer.importexport.processor.export_removed.class%
        arguments:
            - "@oro_importexport.context_registry"

    oro_dotmailer.importexport.processor.export_contact:
        class: %oro_dotmailer.importexport.processor.export_contact.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.contact"]]
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setEntityName, [%oro_dotmailer.entity.contact.class%]]

    oro_dotmailer.importexport.processor.export.rejected_contact:
        class: %oro_dotmailer.importexport.processor.export.rejected_contact.class%
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@doctrine"

    oro_dotmailer.importexport.processor.datafield:
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.datafield"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.datafield"]]
            - [setEntityName, [%oro_dotmailer.entity.datafield.class%]]

    oro_dotmailer.importexport.processor.update_entity_field_from_contacts:
        class: %oro_dotmailer.importexport.processor.import.update_entity_field_from_contacts.class%
        parent: oro_dotmailer.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_dotmailer.importexport.data_converter.update_entity_field_from_contacts"]]
            - [setStrategy, ["@oro_dotmailer.importexport.strategy.update_entity_field_from_contacts.add_or_replace"]]

    #serializer
    oro_dotmailer.importexport.normalizer.enum:
        class: %oro_dotmailer.importexport.normalizer.enum.class%
        tags:
            - { name: oro_importexport.normalizer, priority: 20 }

    oro.dotmailer.importexport.normalizer.configurable:
        parent: oro_importexport.serializer.configurable_entity_normalizer
        class: %oro.dotmailer.importexport.normalizer.configurable.class%
        calls:
            - [setManagerRegistry, ["@doctrine"]]
        tags:
            - { name: oro_importexport.normalizer, priority: 20 }

    oro_dotmailer.importexport.normalizer.datetime:
        class: %oro_dotmailer.importexport.normalizer.datetime.class%
        tags:
            - { name: oro_importexport.normalizer, priority: 20 }

    #filters
    oro_dotmailer.placeholder.filter.buttons_filter:
        class: %oro_dotmailer.placeholder.filter.buttons_filter.class%
        arguments:
            - "@oro_marketing_list.provider.contact_information_fields"

    oro_dotmailer.placeholder.filter.email_campaign:
        class: %oro_dotmailer.placeholder.filter.email_campaign.class%
        arguments:
            - "@doctrine"

    oro_dotmailer.placeholder.filter.sync_status:
        class: %oro_dotmailer.placeholder.filter.marketing_list.class%
        arguments:
            - "@doctrine"

    #workflow actions
    oro_dotmailer.workflow.action.abstract_marketing_list_entities:
        class: %oro_dotmailer.workflow.action.abstract_marketing_list_entities.class%
        astract: true
        arguments:
            - "@oro_action.expression.context_accessor"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_dotmailer.provider.marketing_list_items.query_builder"
            - "@oro_dotmailer.model.field_helper"

    oro_dotmailer.workflow.action.update_email_campaign_statistics:
        class: %oro_dotmailer.workflow.action.update_email_campaign_statistics.class%
        parent: oro_dotmailer.workflow.action.abstract_marketing_list_entities
        calls:
            - [setCampaignStatisticProvider, ["@oro_dotmailer.provider.campaign_statistic"]]
        tags:
            - { name: oro_action.action, alias: update_email_campaign_dm_statistics }

    oro_dotmailer.workflow.action.create_marketing_list_unsubscribed_item:
        class: %oro_dotmailer.workflow.action.create_marketing_list_state_item.class%
        parent: oro_dotmailer.workflow.action.abstract_marketing_list_entities
        calls:
            - [setMarketingListStateItemClassName, [%oro_marketing_list.unsubscribed_item.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
        tags:
            - { name: oro_action.action, alias: dm_create_marketing_list_unsubscribed_item }

    oro_dotmailer.workflow.action.create_marketing_list_removed_item:
        class: %oro_dotmailer.workflow.action.create_marketing_list_state_item.class%
        parent: oro_dotmailer.workflow.action.abstract_marketing_list_entities
        calls:
            - [setMarketingListStateItemClassName, [%oro_marketing_list.removed_item.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
        tags:
            - { name: oro_action.action, alias: dm_create_marketing_list_removed_item }

    oro_dotmailer.workflow.action.remove_marketing_list_unsubscribed_item:
        class: %oro_dotmailer.workflow.action.remove_marketing_list_state_item.class%
        parent: oro_dotmailer.workflow.action.abstract_marketing_list_entities
        calls:
            - [setMarketingListStateItemClassName, [%oro_marketing_list.unsubscribed_item.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
        tags:
            - { name: oro_action.action, alias: remove_marketing_list_unsubscribed_item }

    oro_dotmailer.workflow.action.remove_marketing_list_removed_item:
        class: %oro_dotmailer.workflow.action.remove_marketing_list_state_item.class%
        parent: oro_dotmailer.workflow.action.abstract_marketing_list_entities
        calls:
            - [setMarketingListStateItemClassName, [%oro_marketing_list.removed_item.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
        tags:
            - { name: oro_action.action, alias: remove_marketing_list_removed_item }

    #helpers
    oro_dotmailer.model.field_helper:
        class: %oro_dotmailer.model.field_helper.class%
        arguments:
            - "@oro_entity.virtual_field_provider"

    #writer
    oro_dotmailer.importexport.writer.import:
        parent: oro_integration.writer.persistent_batch_writer
        class: %oro_dotmailer.importexport.writer.import.class%
        calls:
            - [setLogHelper, ["@oro_dotmailer.log_helper"]]

    oro_dotmailer.importexport.writer.contact_sync:
        parent: oro_dotmailer.importexport.writer.import
        class: %oro_dotmailer.importexport.writer.contact_sync.class%

    oro_dotmailer.importexport.writer.unsubscribed_contact_sync:
        parent: oro_dotmailer.importexport.writer.import
        class: %oro_dotmailer.importexport.writer.unsubscribed_contact_sync.class%

    oro_dotmailer.importexport.writer.import.remove:
        class: %oro_dotmailer.importexport.writer.import.remove.class%
        arguments:
            - "@doctrine"
            - "@oro_integration.logger.strategy"
            - "@oro_dotmailer.log_helper"

    oro_dotmailer.importexport.writer.import.removed_contact:
        class: %oro_dotmailer.importexport.writer.import.removed_contact.class%
        parent: oro_dotmailer.importexport.writer.import

    oro_dotmailer.importexport.writer.export.removed_contacts:
        class: %oro_dotmailer.importexport.writer.export.removed_contacts.class%
        arguments:
            - "@doctrine"
            - "@oro_dotmailer.transport.integration_transport"
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_dotmailer.log_helper"

    oro_dotmailer.importexport.writer.export.rejected_contact:
        class: %oro_dotmailer.importexport.writer.export.rejected_contact.class%
        arguments:
            - "@doctrine"
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_dotmailer.log_helper"

    oro_dotmailer.importexport.writer.export.contacts:
        class: %oro_dotmailer.importexport.writer.export.contacts.class%
        arguments:
            - "@doctrine"
            - "@oro_dotmailer.transport.integration_transport"
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_dotmailer.log_helper"

    #emailCampaign Voter
    oro_dotmailer.email_campaign.security.acl.voter.entity:
        class: %oro_dotmailer.email_campaign.security.acl.voter.entity.class%
        arguments:
            - "@oro_entity.doctrine_helper"
        calls:
            - [setClassName, [%oro_campaign.email_campaign.entity.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    oro_dotmailer.acl.voter.marketing_list_state_item:
        class: %oro_dotmailer.acl.voter.marketing_list_state_item.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_dotmailer.model.field_helper"
            - %oro_dotmailer.entity.contact.class%
        calls:
            - [setClassName, [%oro_marketing_list.unsubscribed_item.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    #listeners
    oro_dotmailer.listener.datagrid.marketing_list_item:
        class: %oro_dotmailer.listener.datagrid.marketing_list_item.class%
        arguments:
            - "@doctrine"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_dotmailer.model.field_helper"
            - "@oro_marketing_list.model.helper"
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after, method: onBuildAfter }

    oro_dotmailer.listener.cache_clear:
        class: %oro_dotmailer.listener.cache_clear.class%
        arguments:
            - "@oro_dotmailer.provider.cache"
        tags:
            - { name: doctrine.event_subscriber }

    oro_dotmailer.listener.contact_export:
        class: %oro_dotmailer.listener.contact_export.class%
        arguments:
            - "@doctrine"
            - "@oro_dotmailer.export_manager"
        tags:
            - { name: kernel.event_subscriber }

    oro_dotmailer.listener.update_address_book_last_imported_date:
        class: %oro_dotmailer.listener.update_address_book_last_imported_date.class%
        arguments:
            - "@doctrine"
        tags:
            - { name: kernel.event_subscriber }

    oro_dotmailer.transport.dotmailer:
        class: %oro_dotmailer.transport.dotmailer.class%
        tags:
            - { name: oro_campaign.email_transport }

    oro_dotmailer.async.export_contacts_status_update_processor:
        class: 'Oro\Bundle\DotmailerBundle\Async\ExportContactsStatusUpdateProcessor'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@oro_dotmailer.export_manager'
            - '@oro_message_queue.job.runner'
            - '@logger'
        tags:
            - { name: 'oro_message_queue.client.message_processor' }

    oro_dotmailer.listener.datafield_remove:
        class: "%oro_dotmailer.listener.datafield_remove.class%"
        arguments:
            - "@oro_dotmailer.datafield_manager"
        tags:
            - { name: doctrine.event_listener, event: preRemove }

    oro_dotmailer.listener.add_default_mapping:
        class: %oro_dotmailer.listener.add_default_mapping.class%
        arguments:
            - "@doctrine"
            - "@oro_entity.doctrine_helper"
            - "@oro_marketing_list.entity_provider.contact_information"
            - "@oro_integration.helper.default_owner_helper"
            - "@oro_dotmailer.listener.mapping_update"
        tags:
            - { name: kernel.event_subscriber }

    oro_dotmailer.listener.navigation:
        class: %oro_dotmailer.listener.navigation.class%
        arguments:
            - "@doctrine"
        tags:
            - { name: kernel.event_listener, event: oro_menu.configure.application_menu, method: onNavigationConfigure }
            - { name: kernel.event_listener, event: oro_menu.configure.shortcuts, method: onNavigationConfigure }

    oro_dotmailer.listener.mapping_update:
        class: 'Oro\Bundle\DotmailerBundle\EventListener\MappingUpdateListener'
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_dotmailer.provider.mapping"
        tags:
            - { name: doctrine.event_listener, event: onFlush, method: onFlush }
            - { name: doctrine.event_listener, event: postFlush, method: postFlush }

    oro_dotmailer.listener.entity_update:
        class: 'Oro\Bundle\DotmailerBundle\EventListener\EntityUpdateListener'
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_dotmailer.provider.mapping"
        tags:
            - { name: doctrine.event_listener, event: onFlush, method: onFlush }

    oro_dotmailer.processor.mapped_fields_change:
        class: 'Oro\Bundle\DotmailerBundle\Processor\MappedFieldsChangeProcessor'
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_dotmailer.query_designer.parent_entity_query_converter"
        calls:
            - [setLogger, ["@logger"]]

    #validators
    oro_dotmailer.validator.datafield_mapping_config:
        class: %oro_dotmailer.validator.datafield_mapping_config.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@translator"
        tags:
            - { name: validator.constraint_validator, alias: oro_dotmailer.validator.datafield_mapping_config }

